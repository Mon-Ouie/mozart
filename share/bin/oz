#!/bin/sh

# uncomment and adapt the following line if you want
# to draw links from say /usr/local/bin to OZHOME/bin
# see chapter "installation" in the users manual for more information

# OZHOME=/usr/local/oz




######################################################################
# you should not edit below this line

# where Oz resides:

howcalled=$0
cmd=`basename $howcalled`

if test -z "${OZHOME}"
then
  dir=`dirname $howcalled`
  OZHOME=`(cd $dir; cd ..; /bin/pwd)`
  export OZHOME
fi

: ${OZPLATFORM=`$OZHOME/bin/ozplatform`}
: ${OZEMULATOR=$OZHOME/platform/$OZPLATFORM/emulator.exe}

# set OZPATH & PATH
if test -z "${OZ_PI}"
then
  # where Oz searches for files:
  if test -z "${OZPATH}"
  then
     OZPATH=.
  fi
  OZPATH=${OZPATH}:${OZHOME}/share
  export OZPATH
  # increment path
  PATH=${OZHOME}/bin:${PATH}
  export PATH
  OZ_PI=1
  export OZ_PI
fi

case "$cmd" in

   oz)
        if test -z "${OZEMACS}"
        then
            IFS="${IFS=   }"; saveifs="$IFS"; IFS="$IFS:"
            for name in emacs xemacs lemacs; do
                for dir in $PATH; do
                    test -z "$dir" && dir=.
                    if test -f $dir/$name; then
                        # Not all systems have dirname.
                        OZEMACS=$dir/$name
                        break 2
                    fi
                done
            done
            IFS="$saveifs"
            if test -z "${OZEMACS}"
            then
                echo "Cannot find emacs" 1>&2
                echo "Try setting environment variable OZEMACS" 1>&2
                exit 1
            fi
        fi
        exec $OZEMACS -l $OZHOME/share/elisp/oz.elc -f run-oz "$@"
        ;;

   ozengine)  # that is the real thing
        if test $# -lt 1
        then
            echo "usage: ozengine <url> <args>" 1>&2;
            exit 1;
        fi
        url=$1
        shift
        exec $OZEMULATOR -u $url -- "$@"
        ;;

   text2pickle)
        exec $OZHOME/platform/$OZPLATFORM/$cmd "$@"
        ;;

   pickle2text|oldpickle2text)
        exec $OZEMULATOR --pickle2text "$@" |
             $OZHOME/platform/$OZPLATFORM/text2pickle --textmode
        ;;

   *)
        echo "Unknown invocation of Oz via '$cmd'" 1>&2
        exit 1
        ;;
esac
