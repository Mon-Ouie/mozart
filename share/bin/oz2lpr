#! /bin/sh
# this file is maintained by CVS in module 'Oz/bin'

# drucke oz dateien aus
# prinzip: oz2tex --> latex --> dvips
# Argumente: oz-files

if [ $# -lt 1 ]; then
  echo "usage: $0 <oz-files>"
  exit 1
fi


cleanup() { rm -f /tmp/$tmpfile* /tmp/$ozfile* /tmp/oz2tex_preamble*; }

trap cleanup 0 1 2 15

tmpfile=oz2lpr-tex-$$
ozfile=oz2lpr-oz-$$

for i in $@
do

if [ "$i" = "-" ]; then    # input from stdin?
   file="stdin"
   cat > /tmp/$ozfile.oz
else
   if [ -f "$i" ]; then
     file=$i
   else
     file=$i.oz
   fi
   if [ ! -f $file ]; then
     echo "file not found: $file"
     continue
  fi

  cp $file /tmp/$ozfile.oz
fi

oz2tex /tmp/$ozfile.oz > /dev/null 2>&1

if [ $? != 0 ]; then
  echo "oz2tex failed: $file"
  continue
fi

cat >> /tmp/$tmpfile.tex << EOF
\documentstyle[dina4]{article}
\include{oz2tex_preamble}
\pagestyle{empty}
\begin{document}
\input{/tmp/$ozfile.tex}
\end{document}
EOF

echo "latex $tmpfile ..."
(cd /tmp; latex $tmpfile > /dev/null < /dev/null)

if [ $? != 0 ]; then
  echo "latex failed: $file"
  egrep '^\!' /tmp/$tmpfile.log
  cleanup
  continue
fi

echo "dvips $tmpfile ..."
dvips /tmp/$tmpfile > /dev/null 2>&1
cleanup

done # for
