####################################################
@SET_MAKE@
VPATH=          @srcdir@
SRCDIR=         @srcdir@
BUILDTOP=       @BUILDTOP@
SRCTOP=         @SRCTOP@

INSTALL_DIR     = @INSTALL_DIR@

export OZPATH = .:$(SRCDIR)

# Test for spaces
SPACELOCAL = \
        basic nomosim queens
SPACEOZC = $(SPACELOCAL:%=./space/%.ozc)

# Tests for finite domains
FDLOCAL = \
        distribute alpha money misc1 misc2 \
        watlasm dsum sumabs constrdisj binpacking \
        bridge buildhouse cars change color \
        conference configuration diagnosis divmod \
        donald equations family fraction guards \
        zebra grocery pythagoras safe schur multiply \
        tiling srat students hubert pigeon permutation \
        kalotan knights houses warehouse bridge_noterm \
        queens mapcoloring magicsquare magicsequence \
        photo

FDOZC = $(FDLOCAL:%=./fd/%.ozc)

# Tests for finite sets
FSLOCAL = \
        crew \
        hamming \
        steiner \
        knapsack \
        misc

FSOZC = $(FSLOCAL:%=./fs/%.ozc)

# Tests for scheduling
SCHEDLOCAL = \
        abz6 \
        company \
        product

SCHEDOZC = $(SCHEDLOCAL:%=./scheduling/%.ozc)

FCORE = \
        conversion float record type exception guards misc \
        link instruction except dictionary ofs


CORE = $(FCORE:%=./core/%.ozc)

DIRS = core space fd fs scheduling

# All tests
COMPONENTS = \
        $(CORE) $(SPACEOZC) $(FDOZC) $(SCHEDOZC) $(FSOZC)


####################################################

OZBATCH = @OZBATCH@
OZFLAGS = --nowarnunused

OZE = $(OZBATCH) $(OZFLAGS)
OZC = $(OZE) -c

all: oztest

bootstrap:

install:

check: oztest
        ./oztest --verbose

.PHONY: dirs

dirs:
        ds="$(DIRS)"; for d in $$ds; do if test ! -d $$d; then $(INSTALL_DIR) $$d; fi; done

oztest: lib/make-test.oz lib/engine.oz \
        lib/passed.oz lib/failed.oz lib/help-string.oz \
        $(COMPONENTS)
        $(MAKE) dirs
        $(OZE) -l AP,SP lib/make-test.oz
        ./make-test -verbose $(COMPONENTS)
        -rm -f ./make-test


clean:
        -rm -f *~ ./*/*~ ./*/*/*~
        -rm -f $(COMPONENTS)
        -rm -f make-test
        -rm -f te.ozc

veryclean: clean
        -rm -f oztest

distclean: veryclean
        -rm -f Makefile

.SUFFIXES: $SUFFIXES .ozc .oz

.oz.ozc:
        $(OZC) $< -o $@

include $(SRCTOP)/share/Makefile.boot

bootstrap:

Makefile: Makefile.in ../config.status
        cd .. && ./config.status

../config.status: ../configure
        cd .. && ./config.status --recheck
