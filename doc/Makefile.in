#
#  Author:
#    Denys Duchier <duchier@ps.uni-sb.de>
#
#  Contributor:
#    Leif Kornstaedt <kornstae@ps.uni-sb.de>
#
#  Copyright:
#    Denys Duchier, 1998
#
#  Last change:
#    $Date$ by $Author$
#    $Revision$
#
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     http://mozart.ps.uni-sb.de
#
#  See the file "LICENSE" or
#     http://mozart.ps.uni-sb.de/LICENSE.html
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.
#

PREFIX		= @prefix@
VPATH		= @srcdir@
SHDOCDIR	= $(PREFIX)/share/doc
DOCDIR		= $(PREFIX)/doc

INSTALL		= @INSTALL@
INSTALL_FILE	= $(INSTALL) -m 444
INSTALL_DIR	= @INSTALL_DIR@
CED		= @CED@
HOMEURL         = @HOMEURL@


FILES		= ozdoc.dcl ozdoc.dtd ozdoc.doc catalog $(CED) author.db \
		  mozart.bib
LIBFILES	= $(addprefix $(SHDOCDIR)/,$(FILES))

EMACS		= emacs

SUBDIRS		= @SUBDIRS@

.PHONY: all bootstrap check install clean veryclean distclean depend


all bootstrap clean veryclean depend distclean check install::
	dirs="$(SUBDIRS)"; \
	for i in $$dirs; do \
	  if (cd $$i && $(MAKE) $@); \
          then true; \
          else exit 1; \
          fi; \
        done


all:: $(CED)

bootstrap:: all

check::

depend::

Makefile: Makefile.in config.status
	./config.status

install:: all $(SHDOCDIR) $(DOCDIR) $(DOCDIR)/index.html $(LIBFILES)

$(SHDOCDIR) $(DOCDIR):
	$(INSTALL_DIR) $@

$(DOCDIR)/index.html: index.html
	$(INSTALL_FILE) $< $@

$(LIBFILES): $(SHDOCDIR)/% : %
	$(INSTALL_FILE) $< $@

ozdoc.ced: ozdoc.dtd ozdoc.dcl ced.cat ced.el
	$(EMACS) -q -batch -l ced.el
clean::
	-rm -f *~

veryclean:: clean
	-rm -f $(CED) xref.db

distclean:: veryclean
	-rm -f Makefile ced.el catalog config.log config.status config.cache
