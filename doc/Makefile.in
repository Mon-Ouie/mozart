#
#  Author:
#    Denys Duchier <duchier@ps.uni-sb.de>
#
#  Contributor:
#    Leif Kornstaedt <kornstae@ps.uni-sb.de>
#
#  Copyright:
#    Denys Duchier, 1998
#
#  Last change:
#    $Date$ by $Author$
#    $Revision$
#
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     http://mozart.ps.uni-sb.de
#
#  See the file "LICENSE" or
#     http://mozart.ps.uni-sb.de/LICENSE.html
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.
#

PREFIX		= @prefix@
VPATH		= @srcdir@
SHDOCDIR	= $(PREFIX)/share/doc
DOCDIR		= $(PREFIX)/doc
TKDOCBASE       = tcl8.0-tk8.0-man-html
TKDOC           = $(VPATH)/$(TKDOCBASE).tar.gz

INSTALL		= @INSTALL@
INSTALL_FILE	= $(INSTALL) -m 444
INSTALL_DIR	= @INSTALL_DIR@
CED		= @CED@
HOMEURL         = @HOMEURL@


FILES		= ozdoc.dcl ozdoc.dtd ozdoc.doc catalog $(CED) author.db \
		  mozart.bib
LIBFILES	= $(addprefix $(SHDOCDIR)/,$(FILES))

EMACS		= emacs

SUBDIRS		= @SUBDIRS@

.PHONY: all quick bootstrap check install clean veryclean distclean depend tkdoc

all bootstrap:: $(CED)

Makefile: Makefile.in config.status
	./config.status

install:: all $(SHDOCDIR) $(DOCDIR) $(DOCDIR)/index.html $(LIBFILES) tkdoc

tkdoc: $(DOCDIR)
	-rm -rf $(DOCDIR)/$(TKDOCBASE) $(DOCDIR)/tcltk 
	(cd $(DOCDIR) && \
	 gzip -dc $(TKDOC) | tar xf - && \
	 ln -s $(TKDOCBASE) tcltk)

$(SHDOCDIR) $(DOCDIR):
	$(INSTALL_DIR) $@

$(DOCDIR)/index.html: index.html
	$(INSTALL_FILE) $< $@

$(LIBFILES): $(SHDOCDIR)/% : %
	$(INSTALL_FILE) $< $@

ozdoc.ced: ozdoc.dtd ozdoc.dcl ced.cat ced.el
	$(EMACS) -q -batch -l ced.el

all quick bootstrap check install clean veryclean distclean depend::
	dirs="$(SUBDIRS)"; \
	for i in $$dirs; do (cd $$i && $(MAKE) $@) || exit 1; done

clean::
	-rm -f *~

veryclean::
	-rm -f *~
	-rm -f $(CED) xref.db

distclean::
	-rm -f *~
	-rm -f $(CED) xref.db
	-rm -f ced.el catalog
	-rm -f Makefile Makefile.common config.log config.status config.cache
