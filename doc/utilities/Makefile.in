#
#  Author:
#    Leif Kornstaedt <kornstae@ps.uni-sb.de>
#
#  Copyright:
#    Leif Kornstaedt, 1998
#
#  Last change:
#    $Date$ by $Author$
#    $Revision$
#
#  This file is part of Mozart, an implementation of Oz 3:
#     http://www.mozart-oz.org
#
#  See the file "LICENSE" or
#     http://www.mozart-oz.org/LICENSE.html
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.
#

PREFIX		= @prefix@
VPATH		= @srcdir@
SRCDIR		= @srcdir@
SRCTOP		= @SRCTOP@
BUILDTOP	= @BUILDTOP@
BINDIR		= $(PREFIX)/bin
DOCDIR		= $(PREFIX)/share/doc
HOMEURL         = @HOMEURL@
PLATFORM	= @PLATFORM@

INSTALL		= @INSTALL@
INSTALL_DIR	= @INSTALL_DIR@
INSTALL_BIN	= $(INSTALL) -m 555
INSTALL_FILE	= $(INSTALL) -m 444

OZCFLAGS	= 
OZC		= @OZC@
OZL		= @OZL@
EMACS		= emacs
OZENGINE	= @OZENGINE@

FUNCTORS = \
	SGML.ozf AuthorDB.ozf BibliographyDB.ozf Indexer.ozf Fontifier.ozf \
	CrossReferencer.ozf Thumbnails.ozf LaTeXToGIF.ozf PostScriptToGIF.ozf \
	File.ozf HTML.ozf OzDocToHTML.ozf Main.ozf Chunk.ozf

SYSLETS = ozdoc
SHELLSCRIPTS = latex2gif gif2thumbnail

BINFILES = $(SYSLETS:%=$(BINDIR)/%)
DOCBINFILES = $(SHELLSCRIPTS:%=$(DOCDIR)/%)
DOCFILES = $(DOCDIR)/html.bst

.PHONY: bootstrap bootquick all clean veryclean distclean quick boot-quick clean-xref

all: $(FUNCTORS) $(SYSLETS) $(ELCS)

quick:
depend:
bootquick: boot-all
boot-quick: boot-all

include $(SRCTOP)/share/Makefile.boot

bootstrap: boot-all

Makefile: Makefile.in config.status
	./config.status

ozdoc: $(FUNCTORS)
	$(OZL) -z 9 -x Main.ozf -o $@

%.ozf: %.oz
	$(OZC) $(OZCFLAGS) -c $< -o $@

%.elc: %.el
	-rm -f $@
	$(EMACS) -q -batch -f batch-byte-compile $<
	if [ $<c != $@ ]; then mv $<c $@; fi

install: $(BINDIR) $(BINFILES)
install: $(DOCDIR) $(DOCBINFILES) $(DOCFILES)
installps:

$(BINDIR) $(DOCDIR):
	$(INSTALL_DIR) $@

$(BINFILES): $(BINDIR)/% : %
	$(INSTALL_BIN) $< $@

$(DOCBINFILES): $(DOCDIR)/% : %
	$(INSTALL_BIN) $< $@

$(DOCFILES): $(DOCDIR)/% : %
	$(INSTALL_FILE) $< $@

clean:
	rm -rf $(FUNCTORS) $(SYSLET) $(ELCS)

veryclean: clean

distclean: veryclean
	rm -f Makefile config.log config.status config.cache
clean-xref:
