<!--
  - Authors:
  -   Christian Schulte <schulte@dfki.de>
  -
  - Copyright:
  -   Christian Schulte, 1998
  -
  - Last change:
  -   $Date$ by $Author$
  -   $Revision$
  -
  - This file is part of Mozart, an implementation
  - of Oz 3
  -    http://mozart.ps.uni-sb.de
  -
  - See the file "LICENSE" or
  -    http://mozart.ps.uni-sb.de/LICENSE.html
  - for information on usage and redistribution
  - of this file, and for a DISCLAIMER OF ALL
  - WARRANTIES.
  -
  -->


<Chapter id="chapter.text">
  <Title/Text Widgets/

  <p>
    Text widgets display (as suggested by the name) one or more lines
    of text, where the text can be edited. It offers commands to
    manipulate segments of text and to embed other widgets into the
    flow of text.

  <section id="section.text.widget">
    <title/Inserting Text/

    <p>
      Let us start with a very simple example where we want to display
      a given text in a text widget. <ptr to="figure.text.started">
      shows a program that does the job.

    <p>
      <figure id="figure.text.started">
        <caption/Displaying text./
        <p>
          <picture.extern to="display.gif" type=gif>
<chunk class=anonymous><title/text display/
Te={New Tk.text tkInit(parent:T width:40 height:10 bg:ivory)}
{Te tk(insert 'end' 
       <chunk.ref/Sample text/)}
</chunk>          
      </figure>

    <p>
      You will immediately note two things. Firstly, not the whole
      text is visible. Similar to <ref
      to="section.widgets-2.listbox"/listboxes/, a text widget
      supports scanning: The text can be scanned by pressing the
      second mouse button and moving the mouse pointer while the
      button is still being pressed. Secondly, the text is wrapped
      where word boundaries (that is, spaces) are not taken into
      account. Changing the wrapping such that word boundaries are
      preserved, can be done as follows:
<chunk class=anonymous><title/wrap:word/
{Te tk(configure wrap:word)}
</chunk>

    <p>
      Positions in the displayed text can be referred to by
      <def/positions/.

    <p>
      Getting text.

    <p>
      Inserting text.

    <p>
      Deleting text.

    <p>
      Special positions.

    <p>
      Display only.
   
  </section>

  <section id="section.text.tags">
    <title/Text Tags/

  </section>

  <section id="section.text.toy">
    <title/Example: A ToyText Browser/

    <p>
      <figure id="figure.text.head">
<chunk><title/Definition of Head/
local
   HF={New Tk.font    tkInit(family:helvetica size:18 weight:bold)}
   HT={New Tk.textTag tkInit(parent:Te)}
in
   {HT tk(configure font:HF foreground:orange)}
   proc {Head E Rs}
      {Te tk(insert p(0 0) E#'\n' HT)}
      {HT tkBind(event:  '<1>'
		 action: proc {$} {Display Rs} end)}
   end
end
</chunk>
      </figure>

    <p>
      <figure id="figure.text.body">
<chunk><title/Definition of Body/
local
   BF={New Tk.font    tkInit(family:helvetica size:12 weight:normal)}
   BT={New Tk.textTag tkInit(parent:Te)}
   proc {Do Es T Rs}
      case Es of nil then skip
      [] E|Er then
	 case E
	 of a(ref:R Es) then
	    RT={New Tk.textTag tkInit(parent:Te)}
	 in
	    {RT tk(configure font:BF foreground:blue underline:true)}
	    {RT tkBind(event: '<1>'
		       action: proc {$} {Display R|Rs} end)}
	    {Do Es RT Rs}
	 else
	    {Te tk(insert 'end' E T)}
	 end
	 {Do Er T Rs}
      end
   end
in
   {BT tk(configure font:BF)}
   proc {Body Es Rs}
      {Do Es BT Rs}
   end
end
</chunk>
      </figure>

    <p>
      <figure id="figure.text.display">
<chunk><title/Definition of Display/
proc {Display Rs}
   case Rs of nil then skip
   [] R|Rr then
     {Te tk(delete p(0 0) 'end')}
     {Head ToyText.R.head Rr} {Body ToyText.R.body Rs}
   end      
end
</chunk>
      </figure>

    <p>
      <figure id="figure.text.toy">
      <p>
        <picture.extern to="toy.gif" type=gif>  
<chunk class=anonymous><title/ToyBrowse/
proc {ToyBrowse ToyText Root}
   T ={New Tk.toplevel tkInit}
   Te={New Tk.text   tkInit(parent:T width:40 height:8 bg:white wrap:word)}
   <chunk.ref/Definition of Head/
   <chunk.ref/Definition of Body/
   <chunk.ref/Definition of Display/
in
   {Tk.send pack(Te)}
   {Display [Root]}
end
{ToyBrowse <chunk.ref/Sample ToyText/ canvas}
</chunk>
      </figure>


  </section>

  <section id="section.text.marks">
    <title/Text Marks/

  </section>

<![ %EXTRA; [
<section><title/Examples/
<p>
<chunk><title/EXAMPLES/
%%%
%%% Chapter: Text Widgets
%%%

%%
%% Inserting Text
%%

declare
T={New Tk.toplevel tkInit}
<chunk.ref/text display/



%%
%% Text Tags
%%




%%
%% Example: A ToyText Browser
%%

declare
<chunk.ref/ToyBrowse/



%%
%% Text Marks
%%




</chunk>
]]>

</Chapter>
