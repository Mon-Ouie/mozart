#
#  Author:
#    Denys Duchier <duchier@ps.uni-sb.de>
#
#  Contributor:
#    Leif Kornstaedt <kornstae@ps.uni-sb.de>
#
#  Copyright:
#    Denys Duchier, 1998
#
#  Last change:
#    $Date$ by $Author$
#    $Revision$
#
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     http://mozart.ps.uni-sb.de
#
#  See the file "LICENSE" or
#     http://mozart.ps.uni-sb.de/LICENSE.html
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.
#

PREFIX		= @prefix@
VPATH		= @srcdir@
SHDOCDIR	= $(PREFIX)/share/doc
DOCDIR		= $(PREFIX)/doc
TKDOCBASE       = tcl8.0-tk8.0-man-html
TKDOC           = $(VPATH)/$(TKDOCBASE).tar.gz

INSTALL		= @INSTALL@
INSTALL_FILE	= $(INSTALL) -m 444
INSTALL_DIR	= @INSTALL_DIR@
CED		= @CED@
HOMEURL         = @HOMEURL@


FILES		= ozdoc.dcl ozdoc.dtd ozdoc.doc catalog $(CED) author.db \
		  mozart.bib
LIBFILES	= $(addprefix $(SHDOCDIR)/,$(FILES))

EMACS		= emacs

SUBDIRS		= @SUBDIRS@

.PHONY: all quick bootstrap check install clean veryclean distclean depend

all bootstrap:: $(CED)

Makefile: Makefile.in config.status
	./config.status

install:: all $(SHDOCDIR) $(DOCDIR) $(DOCDIR)/index.html $(DOCDIR)/page.gif $(DOCDIR)/ozdoc.css $(LIBFILES) $(DOCDIR)/tcltk

$(DOCDIR)/tcltk: $(TKDOCBASE) $(DOCDIR)
	-rm -rf $(TKDOCBASE)
	gzip -dc < $(TKDOC) | tar xf -
	for i in Keywords TclCmd TclLib TkCmd TkLib UserCmd; do \
	  $(INSTALL_DIR) $(DOCDIR)/tcltk/$$i; \
	  for j in $(TKDOCBASE)/$$i/*; do \
	    $(INSTALL_FILE) $$j $(DOCDIR)/tcltk/$$i; \
	  done; \
	done; \
	cd $(TKDOCBASE) && for i in *.htm; do \
	  $(INSTALL_FILE) $$i $(DOCDIR)/tcltk/$$i; \
	done;



$(SHDOCDIR) $(DOCDIR):
	$(INSTALL_DIR) $@

$(DOCDIR)/index.html: index.html
	$(INSTALL_FILE) $< $@
$(DOCDIR)/ozdoc.css: $(VPATH)/utilities/ozdoc.css
	$(INSTALL_FILE) $< $@
$(DOCDIR)/page.gif: $(VPATH)/utilities/page.gif
	$(INSTALL_FILE) $< $@

$(LIBFILES): $(SHDOCDIR)/% : %
	$(INSTALL_FILE) $< $@

ozdoc.ced: ozdoc.dtd ozdoc.dcl ced.cat ced.el
	$(EMACS) -q -batch -l ced.el

all quick bootstrap check install clean veryclean distclean depend::
	dirs="$(SUBDIRS)"; \
	for i in $$dirs; do (cd $$i && $(MAKE) $@) || exit 1; done

clean::
	-rm -f *~

veryclean::
	-rm -f *~
	-rm -f $(CED) xref.db
	-rm -f $(TKDOCSRC)

distclean::
	-rm -f *~
	-rm -f $(CED) xref.db
	-rm -f ced.el catalog
	-rm -f Makefile Makefile.common config.log config.status config.cache
