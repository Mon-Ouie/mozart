.PHONY:	tags clean+ clean realclean veryclean

install clean realclean depend distclean::
	dirs="$(SUBDIRS)"; for i in $$dirs; do (cd $$i && $(MAKE) $@); done

realclean::
	$(MAKE) clean SUBDIRS=

distclean::
	$(MAKE) realclean SUBDIRS=

clean::
	$(RM) *.o *~  *.bak *.obj

veryclean: realclean

tags::
	etags --regex='/OZ_C[^(]+([ 	]*\([^ 	,)]+\)/\1/' -l c++ \
	*c *h */*c */*h

.SUFFIXES: .cc .m4cc .hh .m4hh .s .E .sed

.cc.s:
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -S -o $@ $<

.cc.E:
	$(CXXCPP) $(CPPFLAGS) -o $@ $<

.m4cc.cc:
	$(M4_S) $< > $@

.m4hh.hh:
	$(M4_S) $< > $@

@tmphack_target@:
	tmp=/tmp/ozobj$$$$.o; \
	trap "$(RM) $$tmp; exit 1" 1 2 15; \
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $$tmp $< && \
		rcp $$tmp @tmphack_host@:`pwd`/$@ && \
		rm -f $$tmp
