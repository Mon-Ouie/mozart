BUILDTOP=	@BUILDTOP@
PREFIX=		@prefix@

PLATFORM	= @platform@
INSTALL		= @INSTALL@
INSTALL_BIN	= $(INSTALL) -s -m 555
MKINSTALLDIRS	= @MKINSTALLDIRS@
CC		= @CC@

LIBS    	= @LIBS@
CPPFLAGS	= @CPPFLAGS@
CFLAGS		= @CFLAGS@
LDFLAGS		= @LDFLAGS@
RM		= @RM@ -f
RMR		= @RM@ -rf
LN		= @LN@ -s
CPR             = @CP@ -R
CHMODR          = @CHMOD@ -R 555

PROVIDETCLLIBS  = @PROVIDETCLLIBS@
TCLLIBTCLDIR    = @oz_tcl_lib_tcl_dir@
TKLIBTCLDIR     = @oz_tk_lib_tcl_dir@


OZWISH		= oz.wish.bin
SRCS		= ozMain.c ozAppInit.c
OBJS		= ${SRCS:.c=.o}

.PHONY: $(PROVIDETCLLIBS)

all: $(OZWISH)

$(OZWISH): $(OBJS)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

clean:
	$(RM) $(OBJS)
	$(RM) *~

veryclean: clean
	$(RM) $(OZWISH)

realclean: veryclean

distclean: veryclean
	$(RM) config.* Makefile
	$(RM) ozwish80.mk ozwish.mk1 ozwish.lk1 ozwish.imp ozwish.map ozwish.sym

install: $(PREFIX)/platform/$(PLATFORM) $(OZWISH) \
	$(PROVIDETCLLIBS) $(PREFIX)/lib/wish
	$(INSTALL_BIN) $(OZWISH) $(PREFIX)/platform/$(PLATFORM)

$(PREFIX)/platform/$(PLATFORM):
	$(MKINSTALLDIRS) $@

provide-link: 
	$(RMR) $(PREFIX)/lib/wish
	$(MKINSTALLDIRS) $(PREFIX)/lib/wish
	(cd $(PREFIX)/lib/wish; $(RMR) tcl)
	(cd $(PREFIX)/lib/wish; $(LN) $(TCLLIBTCLDIR) tcl)
	(cd $(PREFIX)/lib/wish; $(RMR) tk)
	(cd $(PREFIX)/lib/wish; $(LN) $(TKLIBTCLDIR) tk)

provide-copy:
	$(RMR) $(PREFIX)/lib/wish
	$(MKINSTALLDIRS) $(PREFIX)/lib/wish
	(cd $(PREFIX)/lib/wish; $(RMR) tcl)
	(cd $(PREFIX)/lib/wish; $(CPR) $(TCLLIBTCLDIR) .)
	(cd $(PREFIX)/lib/wish; $(LN) tcl8.0 tcl)
	(cd $(PREFIX)/lib/wish; $(CHMODR) tcl)
	(cd $(PREFIX)/lib/wish; $(RMR) tk)
	(cd $(PREFIX)/lib/wish; $(CPR) $(TKLIBTCLDIR) .)
	(cd $(PREFIX)/lib/wish; $(LN) tk8.0 tk)
	(cd $(PREFIX)/lib/wish; $(CHMODR) tk)


