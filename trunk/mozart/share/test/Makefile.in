####################################################

# Tests for exceptions
EXCEPTOZC = except.ozc

# Test for spaces
SPACELOCAL = \
	basic nomosim queens
SPACEOZC = $(SPACELOCAL:%=./space/%.ozc)

# Tests for finite domains
FDLOCAL = \
	distribute alpha money misc1 misc2 \
	watlasm dsum sumabs constrdisj binpacking \
	bridge buildhouse cars change color \
	conference configuration diagnosis divmod \
	donald equations family fraction guards \
	zebra grocery pythagoras safe schur multiply \
	tiling srat students hubert pigeon permutation \
	kalotan knights houses warehouse bridge_noterm \
	queens mapcoloring magicsquare magicsequence \
	photo

FDOZC = $(FDLOCAL:%=./fd/%.ozc)

# Tests for finite domains
FSLOCAL = \
	crew \
	hamming \
	steiner \
	knapsack \
	misc

FSOZC = $(FSLOCAL:%=./fs/%.ozc)

# Tests for scheduling
SCHEDLOCAL = \
	abz6 \
	basf \
	product

SCHEDOZC = $(SCHEDLOCAL:%=./scheduling/%.ozc)

FCORE = \
	conversion float record type exception guards misc \
	link
CORE = $(FCORE:%=./core/%.ozc)


# All tests
COMPONENTS = \
	$(CORE) $(SPACEOZC) $(FDOZC) $(SCHEDOZC) $(EXCEPTOZC)


####################################################

RM      = @RM@ -f
OZBATCH = @OZBATCH@
OZFLAGS = --nowarnunused

OZE = $(OZBATCH) $(OZFLAGS)
OZC = $(OZE) -c

all: oztest 

check: oztest
	$< --verbose

oztest: ./lib/make-test.oz ./lib/engine.oz \
	./lib/passed.oz ./lib/failed.oz ./lib/help-string.oz \
	$(COMPONENTS)
	$(OZE) -l AP,SP ./lib/make-test.oz
	./make-test -verbose $(COMPONENTS)
	$(RM) ./make-test


clean:
	$(RM) *~ ./*/*~ ./*/*/*~
	$(RM) $(COMPONENTS)
	$(RM) make-test

veryclean: clean
	$(RM) oztest

distclean: veryclean
	$(RM) config.cache config.log config.status
	$(RM) Makefile

.SUFFIXES: $SUFFIXES .ozc .oz

.oz.ozc:
	$(OZC) $< -o $@


