#  Authors:
#    Michael Mehl (mehl@dfki.de)
# 
#  Contributors:
#    optional, Contributor's name (Contributor's email address)
# 
#  Copyright:
#    Michael Mehl (mehl@dfki.de)
# 
#  Last change:
#    $Date$ by $Author$
#    $Revision$
# 
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     $MOZARTURL$
# 
#  See the file "LICENSE" or
#     $LICENSEURL$
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.

SRCTOP=		@SRCTOP@
BUILDTOP=	@BUILDTOP@
PREFIX=		@prefix@
SRCDIR= 	@srcdir@
VPATH=	 	@srcdir@
BINDIR		= $(PREFIX)/bin

@SET_MAKE@
LN_S		= @LN_S@
INSTALL		= @INSTALL@
INSTALL_DIR	= @INSTALL_DIR@
INSTALL_BIN	= $(INSTALL) -m 555

SCRIPTS = oz ozplatform ozdynld
LINKS   = ozengine

.PHONY: bootstrap all install clean veryclean distclean

all:

bootstrap: all

install: $(BINDIR)
	$(INSTALL_BIN) $(SCRIPTS:%=$(SRCDIR)/%) $(BINDIR)
	set -x; cd $(BINDIR);\
	for file in $(LINKS); \
        do\
	   rm -f $$file; \
	   $(LN_S) oz $$file; \
        done

$(BINDIR):
	$(INSTALL_DIR) $@

clean:

veryclean: clean

distclean: clean
	rm -f Makefile


# Windows
.PHONY: win-install

all:  version.h

clean:
	rm -f *.exe *.obj *.sym *.map *.mk* *.lk* *.err oz.res setup.res ozdemo.cpp version.h

win-install: setup.exe oz.exe ozdemo.exe ozengine.exe
	$(INSTALL_BIN) setup.exe oz.exe ozdemo.exe ozengine.exe $(PREFIX)


ozdemo.exe ozengine.exe: oz.exe
	cp oz.exe ozdemo.exe
	cp oz.exe ozengine.exe

version.h: $(SRCTOP)/OZVERSION
	echo "#define OZVERSION \"`$<`\"" > $@

check:

Makefile: Makefile.in ../config.status
	cd .. && ./config.status

../config.status: ../configure
	cd .. && ./config.status --recheck
