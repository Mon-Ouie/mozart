#  Authors:
#    Michael Mehl (mehl@dfki.de)
# 
#  Contributors:
#    optional, Contributor's name (Contributor's email address)
# 
#  Copyright:
#    Michael Mehl (mehl@dfki.de)
# 
#  Last change:
#    $Date$ by $Author$
#    $Revision$
# 
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     $MOZARTURL$
# 
#  See the file "LICENSE" or
#     $LICENSEURL$
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.

PREFIX=		@prefix@

SRCDIR		= @srcdir@
BINDIR		= $(PREFIX)/bin
RM		= @RM@ -f
LN_S		= @LN_S@
INSTALL		= @INSTALL@
MKINSTALLDIRS	= @MKINSTALLDIRS@
INSTALL_BIN	= $(INSTALL) -m 555

SCRIPTS = oz ozplatform ozdynld
LINKS   = ozdo ozapplet ozengine

.PHONY: all install clean distclean win-install

all: version.h

install: $(BINDIR)
	$(INSTALL_BIN) $(SCRIPTS:%=$(SRCDIR)/%) $(BINDIR)
	@set -x; cd $(BINDIR);\
	for file in $(LINKS); \
        do\
	   $(RM) $$file; \
	   $(LN_S) oz $$file; \
        done

$(BINDIR):
	$(MKINSTALLDIRS) $@

ozdemo.exe ozengine.exe: oz.exe
	cp oz.exe ozdemo.exe
	cp oz.exe ozengine.exe

version.h: ../OZVERSION
	echo "#define OZVERSION \"`$<`\"" > $@


win-install: setup.exe oz.exe ozdemo.exe ozengine.exe
	$(INSTALL_BIN) setup.exe oz.exe ozdemo.exe ozengine.exe $(PREFIX)

clean:
	$(RM) *.exe *.obj *.sym *.map *.mk* *.lk* *.err oz.res setup.res ozdemo.cpp version.h

distclean: clean
	$(RM) Makefile config.cache config.log config.status
