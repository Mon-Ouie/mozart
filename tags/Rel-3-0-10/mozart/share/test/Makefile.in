####################################################
@SET_MAKE@
VPATH=		@srcdir@
SRCDIR=		@srcdir@
BUILDTOP=	@BUILDTOP@
SRCTOP=		@SRCTOP@

INSTALL_DIR	= @INSTALL_DIR@

export OZPATH = .:$(SRCDIR)

# Test for spaces
SPACELOCAL = \
	basic nomosim queens
SPACEOZF = $(SPACELOCAL:%=./space/%.ozf)

# Tests for finite domains
FDLOCAL = \
	distribute alpha money misc1 misc2 \
	watlasm dsum sumabs constrdisj binpacking \
	bridge buildhouse cars change color \
	conference configuration diagnosis divmod \
	donald equations family fraction guards \
	zebra grocery pythagoras safe schur multiply \
	tiling srat students hubert pigeon permutation \
	kalotan knights houses warehouse bridge_noterm \
	queens mapcoloring magicsquare magicsequence \
	photo coins

FDOZF = $(FDLOCAL:%=./fd/%.ozf)

# Tests for finite sets
FSLOCAL = \
	golf crew hamming steiner knapsack misc

FSOZF = $(FSLOCAL:%=./fs/%.ozf)

# Tests for scheduling
SCHEDLOCAL = \
	abz6 company product

SCHEDOZF = $(SCHEDLOCAL:%=./scheduling/%.ozf)

FCORE = \
	conversion float record type exception guards future misc \
	link instruction compiler except dictionary ofs

CORE = $(FCORE:%=./core/%.ozf)

DP1= \
	mini
DP = $(DP1:%=./dp/%.ozf)

FTOOLS = \
	gump

TOOLS = $(FTOOLS:%=./tools/%.ozf)

DIRS = core space fd fs scheduling dp tools

# All tests
COMPONENTS = \
	$(CORE) $(SPACEOZF) $(FDOZF) $(SCHEDOZF) $(FSOZF) $(DP) $(TOOLS)


####################################################

OZC = @OZC@
OZFLAGS =

OZEE = $(OZC) $(OZFLAGS)
OZCC = $(OZEE) -c

all: oztest

bootstrap:

install:

check: oztest
	./oztest --verbose

dirs:
	@ds="$(DIRS)"; for d in $$ds; do if test ! -d $$d; then $(INSTALL_DIR) $$d; fi; done && touch $@

$(COMPONENTS): dirs

oztest: lib/make-test.oz lib/engine.oz \
	lib/passed.oz lib/failed.oz lib/help-string.oz \
	$(COMPONENTS)
	$(OZC) $(OZFLAGS) -x lib/make-test.oz -o make-test
	./make-test -verbose $(COMPONENTS:%=`pwd`/%)
	-rm -f ./make-test


clean:
	-rm -f *~ ./*/*~ ./*/*/*~
	-rm -f $(COMPONENTS)
	-rm -f LambdaScanner.* LambdaParser.*
	-rm -f make-test
	-rm -f te.ozf

veryclean: clean
	-rm -f oztest

distclean: veryclean
	-rmdir $(DIRS)
	-rm -f Makefile dirs

.SUFFIXES:
.SUFFIXES: $SUFFIXES .ozf .oz

.oz.ozf:
	$(OZCC) $< -o $@

include $(SRCTOP)/share/Makefile.boot

bootstrap:

Makefile: Makefile.in ../config.status
	cd .. && ./config.status

../config.status: ../configure
	cd .. && ./config.status --recheck


