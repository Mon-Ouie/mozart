#
#  Authors:
#    Alberto Delgado (adelgado@cic.puj.edu.co)
#    Alejandro Arbelaez (aarbelaez@cic.puj.edu.co)
#    Gustavo Gutierrez (ggutierrez@cic.puj.edu.co)
# 
#  Contributors:
# 			Andres Felipe Barco (anfelbar@univalle.edu.co)
#  Copyright:
#    Alberto Delgado, 2006-2007
#    Alejandro Arbelaez, 2006-2007
#    Gustavo Gutierrez, 2006-2007
# 
#  Last change:
#    $Date$ by $Author$
#    $Revision$
# 
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     http://www.mozart-oz.org
# 
#  See the file "LICENSE" or
#     http://www.mozart-oz.org/LICENSE.html
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.
#
#

include ../Makefile.vars

BUILDTOP	= @BUILDTOP@
VPATH		= @srcdir@
SRCDIR		= @srcdir@
INCS		= -I$(SRCDIR) -I. -I$(SRCDIR)/.. -I..

GECODE_LIBS	= `pkg-config --libs gecode`
GECODE_INC	= `pkg-config --cflags gecode`

CFLAGS 		= $(INCS) $(GECODE_INC) $(GESPACE_CXXFLAGS) $(CPPFLAGS) 


GFDBLIBSRC	= GeIntVar.cc GeIntVar-builtins.cc distribute.cc
GFDBLIBOBJS	= $(GFDBLIBSRC:.cc=.o)

GFDPLIBSRC	=  GeFDP-Builtins.cc GeMozProp-builtins.cc GeIntProp-builtins.cc
GFDPLIBOBJS	= $(GFDPLIBSRC:.cc=.o)

all:

# NOTE: $(SRCDIR) added to the dependencies, because in ../../Makefile.in the libs
#       depend also on this dir

../GFDB.so-$(PLATFORM): $(GFDBLIBOBJS)
	$(DYNLD) -o $@ $(GFDBLIBOBJS) $(LDFLAGS) $(GECODE_LIBS)
	
../libGFDB.a: $(GFDBLIBOBJS)
	$(AR) -rc $@ $(GFDBLIBOBJS) && $(RANLIB) $@
	
../GFDP.so-$(PLATFORM): $(GFDPLIBOBJS)
	$(DYNLD) -o $@ $(GFDPLIBOBJS) $(LDFLAGS) $(GECODE_LIBS)
	
../libGFDP.a: $(GFDPLIBOBJS)
	$(AR) -rc $@ $(GFDPLIBOBJS) && $(RANLIB) $@	


depend:: Makefile $(GFDBLIBSRCS) $(GFDPLIBSRCS)
	$(DEPEND) $(GFDBLIBSRCS:%=$(SRCDIR)/%) $(GFDPLIBSRCS:%=$(SRCDIR)/%) \
		| sed -e 's/\.o:/\.lo:/g' > Makefile.deps

%.o: %.cc
	$(CXX) $(OPTIMIZE) $(CFLAGS) -c $< -o $@

first:

Makefile: Makefile.in
	(cd ..; ./config.status)

-include Makefile.deps
include ../Makefile.rules

distclean::
	-rm -f Makefile makefile $(GENERATED_FILES)

veryclean::
	-rm -f *.a *.so-$(PLATFORM) TAGS Makefile.deps $(GENERATED_FILES)

cleaner::
	-rm -f *.a *.so-$(PLATFORM) $(GENERATED_FILES)


BUILDDIR=$(shell pwd)
tags:	$(CREATEDFILES)
	etags \
	--regex='/OZ_BI_\(io\)?define([ 	]*\([^ 	,)]+\)/\2/' \
	--regex='/OZ_C_\(io\)?proc_begin([ 	]*\([^ 	,)]+\)/\2/' \
	--regex='/OZ_DECLARE[A-Z0-9_]*([ 	]*\([^ 	,)]+\)/\1/' -l c++ \
	-o $(SRCDIR)/TAGS \
	$(addprefix $(BUILDDIR)/,$(CREATEDFILES)) \
	$(SRCDIR)/*c $(SRCDIR)/*h $(SRCDIR)/../*c $(SRCDIR)/../*h  
