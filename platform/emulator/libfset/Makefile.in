#  Authors:
#    Michael Mehl (mehl@dfki.de)
#
#  Contributors:
#    optional, Contributor's name (Contributor's email address)
#
#  Copyright:
#    Michael Mehl (mehl@dfki.de)
#
#  Last change:
#    $Date$ by $Author$
#    $Revision$
#
#  This file is part of Mozart, an implementation
#  of Oz 3:
#     $MOZARTURL$
#
#  See the file "LICENSE" or
#     $LICENSEURL$
#  for information on usage and redistribution
#  of this file, and for a DISCLAIMER OF ALL
#  WARRANTIES.


VPATH           = @srcdir@
FSETDIR         = @srcdir@
FDINCS          = -I.. -I$(FSETDIR)/..
CFLAGS          = $(COPT) $(DEFS) $(INCS) $(FDINCS) $(CWARN) $(CUSR)
CXXFLAGS        = $(CFLAGS)
DEPEND          = @DEPEND@ $(DEFS) $(INCS) $(FDINCS)
FSETTARGETS     = @FSETTARGETS@

FSETLIBSRCS =   standard.cc telling.cc \
                testing.cc fsaux.cc \
                intsets.cc monitor.cc \
                reified.cc fsstd.cc \
                std_n.cc

FSETLIBOBJS = $(FSETLIBSRCS:.cc=.o)

all: $(FSETTARGETS)

fsetlib.so: $(FSETLIBOBJS)
        $(DYNLD) -o $@ $(FSETLIBOBJS)

libfset.a: $(FSETLIBOBJS)
        $(AR) -rc $@ $(FSETLIBOBJS)
        $(RANLIB) $@

install: @INSTALL_PROP@

install-prop:
        $(INSTALL_BIN) $(FSETTARGETS) $(bindir)

depend: $(FSETLIBSRCS)
        $(DEPEND) `for f in $(FSETLIBSRCS); do echo $(FSETDIR)/$$f; done` >> Makefile

tags:
        etags --regex='/OZ_C[^(]+([     ]*\([^  ,)]+\)/\1/' -l c++ \
        *c *h */*c */*h

clean:
        $(RM) *.o *~  *.bak *.obj

realclean: clean
        $(RM) *.a *.so Makefile

veryclean: realclean

.SUFFIXES: .cc .m4cc .hh .m4hh .s .E .sed

.cc.s:
        $(CXX) $(CXXFLAGS) -S -o $@ $<

.cc.E:
        $(CXX) $(CXXFLAGS) -E -o $@ $<

@tmphack_target@:
        $(CXX) $(CXXFLAGS) -c -o /tmp/$$$$.o $< && \
                rcp /tmp/$$$$.o @tmphack_host@:`pwd`/$@; \
                rm -f /tmp/$$$$.o
