# -*- Makefile -*-
##########################################################################
# TARGETS
##########################################################################

.PHONY: install bootstrap clean veryclean distclean depend

install bootstrap clean veryclean distclean depend::
        dirs="$(SUBDIRS)"; \
        for i in $$dirs; do \
          if (cd $$i && $(MAKE) $@); \
          then true; \
          else exit 1; \
          fi; \
        done

veryclean::
        $(MAKE) clean SUBDIRS=

distclean::
        $(MAKE) veryclean SUBDIRS=

clean::
        -rm -f *.o *~  *.bak *.obj *.so *.a

##########################################################################
# RULES
##########################################################################

.SUFFIXES: .cc .m4cc .hh .m4hh .s .i .sed .perl

.cc.s:
        $(CXX) $(CPPFLAGS) $(CXXFLAGS) -S -o $@ $<

.cc.i:
        $(CXXCPP) $(CPPFLAGS) -o $@ $<

.m4cc.cc:
        $(M4) $(M4_S) $(M4_D) $< > $@ || (rm -f $@; exit 1)

.m4hh.hh:
        $(M4) $(M4_S) $(M4_D) $< > $@ || (rm -f $@; exit 1)

.perl.cc:
        perl $< -body > $@

.perl.hh:
        perl $< -header > $@


@oz_tmphack_target@:
        tmp=/tmp/ozobj$$$$.o; \
        trap "rm -f $$tmp; exit 1" 1 2 15; \
        $(CXX) $(CPPFLAGS) $(CXXFLAGS) -c -o $$tmp $< && \
                rcp $$tmp @oz_tmphack_host@:`pwd`/$@ && \
                rm -f $$tmp
