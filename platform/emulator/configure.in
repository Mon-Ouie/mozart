dnl Process this file with autoconf to produce a configure script.

dnl This will check that we are in the Oz directory and initiate
AC_INIT(oz.h)

AC_CANONICAL_HOST

AC_PROG_MAKE_SET

dnl Checks for programs.
AC_PROG_CXX
AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET

AC_CHECK_PROGS(M4, gm4 m4)
AC_CHECK_PROGS(RM, rm)
AC_CHECK_PROGS(SH, sh bash)
AC_CHECK_PROGS(MV, mv)
AC_CHECK_PROGS(ECHO, echo true)
AC_CHECK_PROGS(SED, gnused sed)

AC_MSG_CHECKING(for --with-debug)
AC_ARG_WITH(debug,
  [--with-debug       include garbage collection (default=yes)])
if test "x$with_debug" = xyes; then
        AC_MSG_RESULT(yes)
        AC_DEFINE(DEBUG)
else
        AC_MSG_RESULT(no)
fi


dnl Checks for libraries.
AC_CHECK_LIB(dl, dlopen)
#AC_CHECK_LIB(dld, dld_init)
AC_CHECK_LIB(gmp, mpz_init)


dnl Replace `main' with a function in -lg:
#AC_CHECK_LIB(g, main)
dnl Replace `main' with a function in -lintl:
#AC_CHECK_LIB(intl, main)
dnl Replace `main' with a function in -lkernel32:
#AC_CHECK_LIB(kernel32, main)
dnl Replace `main' with a function in -lm:
#AC_CHECK_LIB(m, main)
dnl Replace `main' with a function in -lmalloc:
#AC_CHECK_LIB(malloc, main)
dnl Replace `main' with a function in -lnsl:
#AC_CHECK_LIB(nsl, main)
dnl Replace `main' with a function in -lsocket:
#AC_CHECK_LIB(socket, main)
dnl Replace `main' with a function in -lstdc:
#AC_CHECK_LIB(stdc, main)
dnl Replace `main' with a function in -lwinmm:
#AC_CHECK_LIB(winmm, main)
dnl Replace `main' with a function in -lwsock32:
#AC_CHECK_LIB(wsock32, main)

dnl Checks for header files.
#AC_HEADER_DIRENT
#AC_HEADER_STDC
#AC_HEADER_SYS_WAIT
#AC_CHECK_HEADERS(fcntl.h limits.h sys/time.h unistd.h)

dnl Checks for typedefs, structures, and compiler characteristics.
#AC_C_CONST
#AC_C_INLINE
#AC_TYPE_OFF_T
#AC_TYPE_PID_T
#AC_TYPE_SIZE_T
#AC_HEADER_TIME
#AC_STRUCT_TM

dnl Checks for library functions.
#AC_FUNC_ALLOCA
#AC_FUNC_MEMCMP
#AC_TYPE_SIGNAL
#AC_FUNC_VPRINTF
#AC_CHECK_FUNCS(getcwd gethostname putenv select socket strdup strerror strstr strtod uname)

COPT="-O2"

MOREWARN="-Wall -pedantic-errors -W -Wtraditional -Wshadow -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wcast-align -Wwrite-strings -Wconversion -Waggregate-return -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -Wnested-externs -Winline -Woverloaded-virtual -Wsynth -Werror"

CWARN="-Wall -W -Wpointer-arith -Wbad-function-cast -Wcast-qual -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wnested-externs -Wsynth -Wno-unused -Wno-reorder -Wno-uninitialized"

DEFINES="-DTHREADED -DFASTREGACCESS -DREGOPT"

case $host_os in
        linux*)
                AC_DEFINE(LINUX)
                COPT="-O6 -fomit-frame-pointer -Wuninitialized"
        ;;
        solaris*)
                AC_DEFINE(SOLARIS)
        ;;
        sunos*)
                AC_DEFINE(SUNOS)
        ;;

        irix*)
                AC_DEFINE(IRIX)
        ;;
        *)
                AC_MSG_ERROR(os $host_os not supported)
        ;;
esac

case "$host_cpu" in
        i?86)
                AC_DEFINE(I486)
        ;;
        sparc)
                AC_DEFINE(SPARC)
        ;;
        *)
                AC_MSG_ERROR(cpu $host_cpu not supported)
        ;;
esac

case "$host" in
i?86-*-linux)
        PLATFORM="-DLINUX_I486=1"
        ;;
sparc-sun-sunos4*)
        PLATFORM="-DSUNOS_SPARC=1 -DSPARC"
        ;;
aix-*)
        COPT=-O
        ;;
esac

AC_SUBST(PLATFORM)
AC_SUBST(COPT)
AC_SUBST(DEFINES)

AC_ARG_ENABLE(sun-pro,
        --enable-sun-pro  use the Sun Pro Compiler,
        DEFINES="-DFASTREGACCESS";COPT="-fast")


# AC_CONFIG_HEADER(conf.h)

AC_OUTPUT(Makefile)
