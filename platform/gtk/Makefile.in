VPATH           = @srcdir@
PREFIX          = @prefix@
BUILDTOP        = @BUILDTOP@

PLATFORM        = @PLATFORM@
PLATFORMDIR     = $(PREFIX)/platform/$(PLATFORM)
INSTALL         = @INSTALL@
INSTALL_BIN     = $(INSTALL) -m 555
INSTALL_DIR     = @INSTALL_DIR@
CC              = @CC@
CXX             = @CXX@

LIBS            = @LIBS@
EXTRALDFLAGS    = @EXTRALDFLAGS@
CPPFLAGS        = -I. -I$(VPATH) @CPPFLAGS@
CFLAGS          = -I. -I$(VPATH) @CFLAGS@
LDFLAGS         = @LDFLAGS@ $(LIBS)
LN_S            = @LN_S@
OZTOOL          = @OZTOOL@
PERL            = @PERL@

SHAREDIR        = $(PREFIX)/share
SHAREFILES      = $(SHAREDIR)/GTK.so-$(PLATFORM)
PLATFORMFILES   = $(PLATFORMDIR)/GTK.so-$(PLATFORM)
GOZWRIGHT       = $(PERL) $(VPATH)/gozwright.pl
GOZCONST        = $(PERL) $(VPATH)/genconstants.pl

ALL_INCLUDES    = -I$(VPATH)/../emulator

GTK_HEADER_PREFIX = @GTK_HDRS@
GDK_HEADER_PREFIX = @GDK_HDRS@

GDK_HEADERS     = $(GDK_HEADER_PREFIX)/gdk.h             \
                  $(GDK_HEADER_PREFIX)/gdkcursors.h      \
                  $(GDK_HEADER_PREFIX)/gdki18n.h         \
                  $(GDK_HEADER_PREFIX)/gdkkeysyms.h      \
                  $(GDK_HEADER_PREFIX)/gdkrgb.h          \
                  $(GDK_HEADER_PREFIX)/gdktypes.h

GTK_HEADERS     = $(GTK_HEADER_PREFIX)/gtk.h             \
                  $(GTK_HEADER_PREFIX)/gtk[a-h]*.h       \
                  $(GTK_HEADER_PREFIX)/gtkimage.h        \
                  $(GTK_HEADER_PREFIX)/gtkinputdialog.h  \
                  $(GTK_HEADER_PREFIX)/gtkitem.h         \
                  $(GTK_HEADER_PREFIX)/gtkitemfactory.h  \
                  $(GTK_HEADER_PREFIX)/gtk[j-z]*.h

ALL_HEADERS     = $(GDK_HEADERS) $(GTK_HEADERS)

OBJECTS         = goz.o gozinterface.o gozsupport.o

.SUFFIXES: .cc .o .c .h $(SUFFIXES)


all: GTK.so-$(PLATFORM)

bootstrap: all


$(OBJECTS): %.o: %.c
        $(OZTOOL) $(CXX) $(CFLAGS) -c $(ALL_INCLUDES) $< -o $@

goz.c: $(ALL_HEADERS)
        $(GOZWRIGHT) --c-wrappers $^ > $@

constantsdeclarations.oz:
        $(GOZCONST)

constantsdefinitions.oz:
        $(GOZCONST)

gozinterface.c: goz.c gozsupport.c
        $(GOZWRIGHT) --interface $^ > $@

GTK.so-$(PLATFORM): $(OBJECTS)
        $(OZTOOL) ld $(LDFLAGS) $(OBJECTS) -o $@

clean:
        -rm -f gozinterface.c goz.c *.o *~ core

veryclean: clean
        -rm -f *.so-*

distclean: veryclean
        -rm -f conf.h config.* Makefile

install: $(PLATFORMDIR) $(PLATFORMFILES) \
         $(SHAREDIR) $(SHAREFILES) $(PROVIDETCLLIBS)


$(PLATFORMDIR)/GTK.so-$(PLATFORM): GTK.so-$(PLATFORM)
        $(INSTALL_BIN) GTK.so-$(PLATFORM) $(PLATFORMDIR)/GTK.so

$(SHAREDIR)/GTK.so-$(PLATFORM): $(PLATFORMDIR)/GTK.so
        $(RM) $(SHAREDIR)/GTK.so-$(PLATFORM)
        (cd $(SHAREDIR) && \
         $(LN_S) ../platform/$(PLATFORM)/GTK.so GTK.so-$(PLATFORM))

Makefile: Makefile.in
        ./config.status

nothing:

$(PLATFORMDIR) $(SHAREDIR):
        $(INSTALL_DIR) $@

check:

depend:
