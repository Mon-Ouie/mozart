@SET_MAKE@
BUILDTOP        = @BUILDTOP@
SRCTOP          = @SRCTOP@
SRCDIR          = @srcdir@
VPATH           = @srcdir@
PREFIX          = @prefix@
PLATFORM        = @PLATFORM@
LIB_DIR         = $(PREFIX)/contrib/compat
BIN_DIR         = $(PREFIX)/bin
HOMEURL         = @HOMEURL@

OZC             = @OZC@

INSTALL         = @INSTALL@
INSTALL_DIR     = @INSTALL_DIR@
INSTALL_LIB     = $(INSTALL) -m 444
INSTALL_DLL     = $(INSTALL) -m 555
INSTALL_BIN     = $(INSTALL) -m 555

TARGETS         = TextPickle.ozf convertTextPickle
LIB_TARGETS     = $(LIB_DIR)/TextPickle.ozf \
                  $(LIB_DIR)/TextPickleScanner.so-$(PLATFORM) \
                  $(BIN_DIR)/convertTextPickle

.PHONY: all install clean veryclean distclean bootstrap depend

%.ozf: %.ozg
        $(OZC) --gump $(OZCFLAGS) -c $< -o $@

all: $(TARGETS)

install: $(LIB_DIR) $(LIB_TARGETS) $(BIN_TARGETS)

$(LIB_DIR):
        $(INSTALL_DIR) $@

$(LIB_DIR)/%.ozf: %.ozf
        $(INSTALL_LIB) $< $@

$(LIB_DIR)/%.so-$(PLATFORM): %.so-$(PLATFORM)
        $(INSTALL_DLL) $< $@

$(BIN_DIR)/%: %
        $(INSTALL_BIN) $< $@

TextPickle.so-$(PLATFORM): TextPickle.ozf
        @echo > /dev/null

convertTextPickle: ConvertTextPickle.oz
        $(OZC) $(OZCFLAGS) -x $< -o $@

clean:
        -rm -f TextPickleScanner.[Clo]

veryclean: clean
        -rm -f *.so-* *.ozf

distclean: clean
        -rm -f config.* Makefile

include $(SRCTOP)/share/Makefile.boot

bootstrap: boot-all

#---------------------------------------------------------------------
# Automatic Makefile update
#---------------------------------------------------------------------

Makefile: Makefile.in config.status
        ./config.status

config.status: configure
        ./config.status --recheck
