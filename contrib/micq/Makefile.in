@SET_MAKE@
BUILDTOP        = @BUILDTOP@
SRCTOP          = @SRCTOP@
PREFIX          = @prefix@
SRCDIR          = @srcdir@
VPATH           = @srcdir@
HOMEURL         = @HOMEURL@
LIB_DIR         = $(PREFIX)/contrib/micq
OZC             = @OZC@
OZC_FLAGS       = --baseurl=$(BUILDTOP)/contrib/micq/
COMPILE         = $(OZC) $(OZC_FLAGS)
OZL             = @OZL@
INSTALL         = @INSTALL@
INSTALL_DIR     = @INSTALL_DIR@
INSTALL_LIB     = $(INSTALL) -m 444
APPLETS         = server.oza client.oza

all:            $(APPLETS)
%.ozf: %.oz
        $(COMPILE) -c $< -o $@
install:        $(LIB_DIR) $(addprefix $(LIB_DIR)/,$(APPLETS))
$(LIB_DIR):
        $(INSTALL_DIR) $@
$(LIB_DIR)/%.oza: %.oza
        $(INSTALL_LIB) $< $@

server.oza: micq
        $(OZL) $< -o $@
client.oza: client
        $(OZL) $< -o $@

micq: startserver.oz server.ozf defaultsettings.ozf
        $(COMPILE) -x $< -o $@

client: startclient.oz client.ozf
        $(COMPILE) -x $< -o $@

server.ozf: server.oz methods.ozf database.ozf mobility.ozf newaccountgui.ozf \
        log.ozf  sysadm.ozf
        $(COMPILE) -c $< -o $@

addapplicationgui.ozf: addapplicationgui.oz methods.ozf
        $(COMPILE) -c $< -o $@
sysadm.ozf: sysadm.oz addapplicationgui.ozf editapplicationgui.ozf
        $(COMPILE) -c $< -o $@
client.ozf : client.oz methods.ozf clientgui.ozf newfriendsgui.ozf \
        defaultsettings.ozf dialoggui.ozf mobility.ozf
        $(COMPILE) -c $< -o $@
clientgui.ozf : clientgui.oz messagedisplay.ozf manager.ozf \
        defaultsettings.ozf popup.ozf messagegui.ozf editaccount.ozf \
        draganddrop.ozf addapplicationgui.ozf configureclient.ozf \
        editapplicationgui.ozf
        $(COMPILE) -c $< -o $@
messagegui.ozf : messagegui.oz popup.ozf
        $(COMPILE) -c $< -o $@

clean veryclean:
        -rm *~ *.ozf *.oza micq client

distclean: veryclean
        -rm Makefile config.*

include $(SRCTOP)/share/Makefile.boot

bootstrap: boot-all

#---------------------------------------------------------------------
# Automatic Makefile update
#---------------------------------------------------------------------

Makefile: Makefile.in config.status
        ./config.status

config.status: configure
        ./config.status --recheck
