@SET_MAKE@
BUILDTOP	= @BUILDTOP@
prefix		= @prefix@
SRCDIR          = @srcdir@
VPATH           = @srcdir@
PLATFORM	= @PLATFORM@
PACKAGE		= @PACKAGE@
PROTOCOL	= @PROTOCOL@
LIB_DIR		= $(prefix)/contrib

OZC		= @OZC@
COMPILE		= $(OZC) -c
OZDYNLD		= @OZDYNLD@

CXX		= @CXX@
CXXFLAGS	= @CXXFLAGS@
CPPBASE		= -I$(SRCDIR)/../../platform/emulator -I$(prefix)/include
CPPFLAGS	= @CPPFLAGS@ $(CPPBASE)
LDFLAGS		= @LDFLAGS@
LIBS		= @LIBS@ -lc

INSTALL		= @INSTALL@
INSTALL_DIR	= @INSTALL_DIR@
INSTALL_LIB	= $(INSTALL) -m 444

TARGETS		= regex.ozf regex.so
LIB_TARGETS	= $(LIB_DIR)/regex.ozf $(LIB_DIR)/regex.so-$(PLATFORM)

.PHONY: all install clean veryclean distclean bootstrap depend

all:		$(TARGETS)
install:	$(LIB_DIR) $(LIB_TARGETS)

$(LIB_DIR):
	$(INSTALL_DIR) $@

$(LIB_DIR)/regex.ozf: regex.ozf
	$(INSTALL_LIB) $< $@

$(LIB_DIR)/regex.so-$(PLATFORM): regex.so
	$(INSTALL_LIB) $< $@

regex.ozf: regex.oz
	$(COMPILE) $< -o $@

regex.so: regex.o
	$(OZDYNLD) -o $@ $< $(LDFLAGS) $(LIBS)

regex.o: regex.cc
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) -c $<

clean veryclean:
	-$(RM) *~ *.ozf *.o *.so

distclean: clean
	-$(RM) config.* Makefile

include $(SRCDIR)/../../share/Makefile.boot

bootstrap: boot-all

#---------------------------------------------------------------------
# Automatic Makefile update
#---------------------------------------------------------------------

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck
